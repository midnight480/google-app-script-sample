# ä½è³€å¸‚ã”ã¿åé›†é€šçŸ¥

ä½è³€å¸‚ã®ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’Google Spreadsheetã§ç®¡ç†ã—ã€åé›†æ—¥ã®å‰æ—¥ã«Discordã«é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹Google Apps Scriptã§ã™ã€‚

## ğŸ¯ æ©Ÿèƒ½

- ä½è³€å¸‚ã®ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
- åé›†æ—¥ã®å‰æ—¥ã«Discordé€šçŸ¥
- Google Spreadsheetã§ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›
- å®šæœŸå®Ÿè¡Œã«ã‚ˆã‚‹è‡ªå‹•é€šçŸ¥

## ğŸ“‹ å‰ææ¡ä»¶

- ä½è³€å¸‚ã®ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿
- Google Spreadsheet
- Discord Webhook URL
- Google Apps Scriptã®å®Ÿè¡Œæ¨©é™

## âš™ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. Google Spreadsheetã®æº–å‚™

#### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®æ§‹é€ 

ä»¥ä¸‹ã®åˆ—ã‚’æŒã¤ã‚·ãƒ¼ãƒˆã‚’ä½œæˆï¼š

| åˆ— | é …ç›® | èª¬æ˜ |
|---|---|---|
| A | æ—¥ä»˜ | åé›†æ—¥ï¼ˆYYYY/MM/DDå½¢å¼ï¼‰ |
| B | æ›œæ—¥ | æ›œæ—¥ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰ |
| C | å¯ç‡ƒã”ã¿ | å¯ç‡ƒã”ã¿ã®åé›†æœ‰ç„¡ï¼ˆâ—‹/Ã—ï¼‰ |
| D | ä¸ç‡ƒã”ã¿ | ä¸ç‡ƒã”ã¿ã®åé›†æœ‰ç„¡ï¼ˆâ—‹/Ã—ï¼‰ |
| E | è³‡æºã”ã¿ | è³‡æºã”ã¿ã®åé›†æœ‰ç„¡ï¼ˆâ—‹/Ã—ï¼‰ |
| F | ç²—å¤§ã”ã¿ | ç²—å¤§ã”ã¿ã®åé›†æœ‰ç„¡ï¼ˆâ—‹/Ã—ï¼‰ |

#### ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

```
æ—¥ä»˜        æ›œæ—¥    å¯ç‡ƒã”ã¿  ä¸ç‡ƒã”ã¿  è³‡æºã”ã¿  ç²—å¤§ã”ã¿
2024/01/15  æœˆ     â—‹       Ã—       Ã—       Ã—
2024/01/16  ç«     Ã—       â—‹       Ã—       Ã—
2024/01/17  æ°´     Ã—       Ã—       â—‹       Ã—
2024/01/18  æœ¨     â—‹       Ã—       Ã—       Ã—
2024/01/19  é‡‘     Ã—       Ã—       Ã—       â—‹
```

### 2. Discord Webhookã®ä½œæˆ

1. Discordã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š â†’ çµ±åˆæ©Ÿèƒ½ â†’ Webhook
2. æ–°ã—ã„Webhookã‚’ä½œæˆ
3. Webhook URLã‚’ã‚³ãƒ”ãƒ¼

### 3. Google Apps Scriptã®è¨­å®š

#### appsscript.jsonã§ã®è¨­å®š

```json
{
  "timeZone": "Asia/Tokyo",
  "dependencies": {},
  "exceptionLogging": "STACKDRIVER",
  "runtimeVersion": "V8"
}
```

#### ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®š

ç’°å¢ƒå¤‰æ•°ã¯Google Apps Scriptã®ã‚¨ãƒ‡ã‚£ã‚¿ã§è¨­å®šã—ã¾ã™ã€‚

1.  **Google Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã**:
    `clasp open`ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ç›´æ¥é–‹ãã¾ã™ã€‚
2.  **ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®š**:
    -   ã‚¨ãƒ‡ã‚£ã‚¿ã®å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã€ï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
    -   ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
    -   ä»¥ä¸‹ã®ã‚­ãƒ¼ã¨å€¤ã‚’è¨­å®šã—ã¾ã™ã€‚
        -   `SPREADSHEET_ID`: `your-spreadsheet-id`
        -   `SHEET_NAME`: `ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«`
        -   `DISCORD_WEBHOOK_URL`: `https://discord.com/api/webhooks/your-webhook-url`
3.  **ä¿å­˜**:
    ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

#### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã®å–å¾—æ–¹æ³•

1. Google Spreadsheetã‚’é–‹ã
2. URLã‹ã‚‰IDã‚’å–å¾—ï¼š
   ```
   https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit
   ```

### 4. æ¨©é™è¨­å®š

åˆå›å®Ÿè¡Œæ™‚ã«ä»¥ä¸‹ã®æ¨©é™ã‚’è¨±å¯ï¼š

- Google Spreadsheetã®èª­ã¿å–ã‚Šæ¨©é™
- å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®æ¥ç¶šæ¨©é™

### 5. ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥
clasp push

# å®šæœŸå®Ÿè¡Œã®è¨­å®š
# Google Apps Scriptã®ãƒˆãƒªã‚¬ãƒ¼è¨­å®šã§å®šæœŸå®Ÿè¡Œã‚’è¨­å®š
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### ãƒ¡ã‚¤ãƒ³é–¢æ•°

```javascript
// å®šæœŸå®Ÿè¡Œç”¨ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°
function checkGarbageSchedule() {
  // ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦Discordã«é€šçŸ¥
}

// æ‰‹å‹•å®Ÿè¡Œç”¨ã®ãƒ†ã‚¹ãƒˆé–¢æ•°
function testGarbageNotification() {
  // ãƒ†ã‚¹ãƒˆç”¨ã®é€šçŸ¥ã‚’é€ä¿¡
}
```

### å®šæœŸå®Ÿè¡Œã®è¨­å®š

1. Google Apps Scriptã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒˆãƒªã‚¬ãƒ¼ã€ã‚’é–‹ã
2. ã€Œãƒˆãƒªã‚¬ãƒ¼ã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ä»¥ä¸‹ã®è¨­å®šã§ä½œæˆï¼š
   - å®Ÿè¡Œã™ã‚‹é–¢æ•°ï¼š`checkGarbageSchedule`
   - å®Ÿè¡Œã™ã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ï¼š`Head`
   - ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹ï¼š`æ™‚é–“ä¸»å°å‹`
   - æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ãƒˆãƒªã‚¬ãƒ¼ã®ã‚¿ã‚¤ãƒ—ï¼š`æ—¥æ¬¡`
   - æ™‚åˆ»ï¼š`åˆå‰7æ™‚`ï¼ˆæ¨å¥¨ï¼‰

## ğŸ“Š é€šçŸ¥å†…å®¹

### ã”ã¿åé›†é€šçŸ¥ä¾‹

```
ğŸ—‘ï¸ æ˜æ—¥ã¯ã”ã¿åé›†æ—¥ã§ã™ï¼

ğŸ“… 2024å¹´1æœˆ16æ—¥ï¼ˆç«ï¼‰
â™»ï¸ åé›†äºˆå®šï¼š
   â€¢ å¯ç‡ƒã”ã¿
   â€¢ è³‡æºã”ã¿

ğŸ“‹ æ³¨æ„äº‹é …ï¼š
   â€¢ å¯ç‡ƒã”ã¿ã¯åˆå‰8æ™‚ã¾ã§ã«å‡ºã—ã¦ãã ã•ã„
   â€¢ è³‡æºã”ã¿ã¯åˆ†åˆ¥ã—ã¦å‡ºã—ã¦ãã ã•ã„
```

### é€šçŸ¥ã‚¿ã‚¤ãƒŸãƒ³ã‚°

- åé›†æ—¥ã®å‰æ—¥åˆå‰7æ™‚
- æ‰‹å‹•å®Ÿè¡Œã§ã‚‚ãƒ†ã‚¹ãƒˆå¯èƒ½

## ğŸ” ãƒ­ã‚°å‡ºåŠ›

æ§‹é€ åŒ–ãƒ­ã‚°ã§è©³ç´°ãªæƒ…å ±ã‚’å‡ºåŠ›ï¼š

```json
{
  "timestamp": "2024-01-01T07:00:00.000Z",
  "level": "INFO",
  "message": "ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèªé–‹å§‹",
  "data": {
    "spreadsheetId": "xxx",
    "sheetName": "ã”ã¿åé›†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«",
    "checkDate": "2024-01-16"
  }
}
```

## ğŸ›  ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„**
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDãŒæ­£ã—ã„ã‹ç¢ºèª
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…±æœ‰è¨­å®šã‚’ç¢ºèª
   - Google Apps Scriptã®æ¨©é™ã‚’ç¢ºèª

2. **Discordã«é€šçŸ¥ã•ã‚Œãªã„**
   - Webhook URLã®å½¢å¼ã‚’ç¢ºèª
   - Discordãƒãƒ£ãƒ³ãƒãƒ«ã®æ¨©é™ã‚’ç¢ºèª
   - ãƒ­ã‚°ã§ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ç¢ºèª

3. **ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œãªã„**
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—æ§‹é€ ã‚’ç¢ºèª
   - æ—¥ä»˜å½¢å¼ãŒæ­£ã—ã„ã‹ç¢ºèª
   - ã‚·ãƒ¼ãƒˆåãŒæ­£ã—ã„ã‹ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```javascript
// è¨­å®šç¢ºèª
checkConfiguration();

// ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
testSpreadsheetAccess();

// Discordé€šçŸ¥ãƒ†ã‚¹ãƒˆ
testDiscordNotification();
```

## ğŸ“ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å¤‰æ›´

`createGarbageMessage`é–¢æ•°ã‚’ç·¨é›†ï¼š

```javascript
function createGarbageMessage(scheduleData) {
  const date = new Date(scheduleData.date);
  const dayOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];
  
  let message = `ğŸ—‘ï¸ æ˜æ—¥ã¯ã”ã¿åé›†æ—¥ã§ã™ï¼\n\n`;
  message += `ğŸ“… ${formatDate(date)}ï¼ˆ${dayOfWeek}ï¼‰\n`;
  message += `â™»ï¸ åé›†äºˆå®šï¼š\n`;
  
  if (scheduleData.combustible) message += `   â€¢ å¯ç‡ƒã”ã¿\n`;
  if (scheduleData.incombustible) message += `   â€¢ ä¸ç‡ƒã”ã¿\n`;
  if (scheduleData.recyclable) message += `   â€¢ è³‡æºã”ã¿\n`;
  if (scheduleData.bulky) message += `   â€¢ ç²—å¤§ã”ã¿\n`;
  
  return message;
}
```

### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ ã®å¤‰æ›´

ç•°ãªã‚‹åˆ—æ§‹é€ ã«å¯¾å¿œã™ã‚‹å ´åˆã€`readGarbageSchedule`é–¢æ•°ã‚’ç·¨é›†ï¼š

```javascript
function readGarbageSchedule() {
  const sheet = SpreadsheetApp.openById(SPREADSHEET_ID).getSheetByName(SHEET_NAME);
  const data = sheet.getDataRange().getValues();
  
  // ã‚«ã‚¹ã‚¿ãƒ åˆ—æ§‹é€ ã«å¯¾å¿œ
  return data.slice(1).map(row => ({
    date: row[0],           // Aåˆ—: æ—¥ä»˜
    combustible: row[2],    // Cåˆ—: å¯ç‡ƒã”ã¿
    incombustible: row[3],  // Dåˆ—: ä¸ç‡ƒã”ã¿
    recyclable: row[4],     // Eåˆ—: è³‡æºã”ã¿
    bulky: row[5]           // Fåˆ—: ç²—å¤§ã”ã¿
  }));
}
```

### è¤‡æ•°åœ°åŸŸå¯¾å¿œ

```javascript
const REGIONS = {
  'saga': {
    spreadsheetId: 'saga-spreadsheet-id',
    sheetName: 'ä½è³€å¸‚ã”ã¿åé›†',
    webhookUrl: 'saga-discord-webhook'
  },
  'other': {
    spreadsheetId: 'other-spreadsheet-id',
    sheetName: 'ä»–åœ°åŸŸã”ã¿åé›†',
    webhookUrl: 'other-discord-webhook'
  }
};
```

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [ä½è³€å¸‚ã”ã¿åé›†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼](https://www.city.saga.lg.jp/kurashi/gomi/)
- [Google Apps Script Spreadsheet Service](https://developers.google.com/apps-script/reference/spreadsheet)
- [Discord Webhook API](https://discord.com/developers/docs/resources/webhook) 